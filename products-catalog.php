<?phpinclude('private/includes/connect.php');include('private/includes/corefuncs.php');// connect to MySQL$conn = dbConnect('query');// prepare the SQL query$sqlCategory = 'SELECT * FROM sb_categories ORDER BY category_id';$sqlMaterial = 'SELECT * FROM sb_materials ORDER BY material_id';$sqlBrand = 'SELECT * FROM sb_brands ORDER BY brand_id';$sqlColor = 'SELECT * FROM sb_colors ORDER BY color_id';$sqlStore = 'SELECT * FROM sb_stores ORDER BY store_id';// submit the query and capture the result$resultCategory = mysql_query($sqlCategory) or die(mysql_error());$resultMaterial = mysql_query($sqlMaterial) or die(mysql_error());$resultBrand = mysql_query($sqlBrand) or die(mysql_error());$resultColor = mysql_query($sqlColor) or die(mysql_error());$resultStore = mysql_query($sqlStore) or die(mysql_error());// find out how many records were retrieved$numRowsCategory = mysql_num_rows($resultCategory);$numRowsMaterial = mysql_num_rows($resultMaterial);$numRowsBrand = mysql_num_rows($resultBrand);$numRowsColor = mysql_num_rows($resultColor);$numRowsStore = mysql_num_rows($resultStore);// remove backslashesnukeMagicQuotes();// initialize flag$done = false;// prepare an array of expected items$expected = array('filename_one', 'filename_two','filename_three', 'filename_four', 'filename_five', 'filename_six', 'filename_pdf', 'title', 'category', 'material', 'brand', 'store', 'color', 'depth', 'width', 'height', 'surface', 'bracket', 'load_B', 'load_TS', 'load_S', 'description');// get details of selected recordif ($_GET && !$_POST) {	if (isset($_GET['product_id']) && is_numeric($_GET['product_id'])) {		$product_id = $_GET['product_id'];	} else {		$product_id = NULL;	}	if ($product_id) {			$sql = "SELECT * FROM sb_products WHERE product_id = $product_id LIMIT 1";		$result = mysql_query($sql) or die (mysql_error());		$row = mysql_fetch_assoc($result);				// This whole next bit is pretty bad performance but it works for this. On a larger site we could cache this info (as it only changes when the products change)				// get the max brand id (the min is 1) -- we need this in case they upload a new brand		$sql = "SELECT MAX(brand_id) FROM sb_products as a LEFT OUTER JOIN sb_brands as b ON a.brand=b.brand_id"; // we only want to get the last brand with a product id (brand with no product is useless)		$result = mysql_query($sql) or die (mysql_error());		if(mysql_num_rows($result))			$maxBrandID = mysql_result($result,0);				// get the max product id for this brand (if it's the same as our product, we need to go to the next brand)		$sql = "SELECT MAX(product_id) FROM sb_products WHERE brand=".$row['brand'];		$result = mysql_query($sql) or die (mysql_error());		if(mysql_num_rows($result))			$maxID = mysql_result($result,0);					// get the min product id for this brand (if it's the same as our product, we need to go to the previous brand)		$sql = "SELECT MIN(product_id) FROM sb_products WHERE brand=".$row['brand'];		$result = mysql_query($sql) or die (mysql_error());		if(mysql_num_rows($result))			$minID = mysql_result($result,0);					$nextBrand = $row['brand'] + 1; 		$prevBrand = $row['brand'] - 1;		if($row['brand']==$maxBrandID) { // last brand			$nextBrand = 1; // next is first brand (loop)		}elseif($row['brand']==1) { // first brand 			$prevBrand = $maxBrandID;// loop back to last brand		}								// start with the common scenario		$myPrevBrand = $row['brand'];		$myNextBrand = $row['brand'];		$sqlPrev = "SELECT product_id FROM sb_products WHERE brand=$myPrevBrand AND product_id < $product_id ORDER BY product_id DESC LIMIT 1";		$sqlNext = "SELECT product_id FROM sb_products WHERE brand=$myNextBrand AND  product_id > $product_id ORDER BY product_id ASC LIMIT 1";				// exceptions		if($maxID==$product_id) { // this is the last item in this brand			// push brand up one NEXT			$myNextBrand = $nextBrand;			$sqlNext = "SELECT MIN(product_id) FROM sb_products WHERE brand=$myNextBrand LIMIT 1";		}elseif($minID==$product_id){// this is the first item in this brand			// drop brand back one for PREV			$myPrevBrand = $prevBrand;			$sqlPrev = "SELECT MAX(product_id) FROM sb_products WHERE brand=$myPrevBrand LIMIT 1";		}				// get the previous item		$result = mysql_query($sqlPrev) or die (mysql_error());		if(mysql_num_rows($result))			$prevID = mysql_result($result,0);				// get the next		$result = mysql_query($sqlNext) or die (mysql_error());		if(mysql_num_rows($result))			$nextID = mysql_result($result,0);						$sql = 'SELECT DISTINCT(link_name),link_file FROM sb_productLinks as a LEFT OUTER JOIN sb_links as b ON a.link_id=b.link_id WHERE product_id="'.$product_id.'" ORDER BY link_name ASC';		$resultLinks = mysql_query($sql) or die (mysql_error());				$sql = 'SELECT DISTINCT(store_name),store_file FROM sb_productStores as a LEFT OUTER JOIN sb_stores as b ON a.store_id=b.store_id WHERE product_id="'.$product_id.'" ORDER BY store_name ASC';		$resultMyStores = mysql_query($sql) or die (mysql_error());	}}?><?php include('includes/header-main.php'); ?>	   <?php if (empty($row)) { ?>   <p class="warning">Invalid request: record does not exist.</p>   <?php }    else { ?>	<!-- START POO -->    <div id="product-poo">    <p><img src="brands/<?php while ($rowBrand = mysql_fetch_assoc($resultBrand)) { 			if( $rowBrand['brand_id'] == $row['brand']) {				echo $rowBrand['brand_file'];				}		 	} ?>" /></p><br />                                 <?php		if($row['filename_pdf']!="") {			echo '<p id="assembly-icon"><img src="images/icon-pdf.gif" alt="Abobe PDF" /></p>';         	echo '<p id="assembly-text"><a href="downloads/'.htmlentities($row['filename_pdf']).'">Assembly<br />Instructions</a></p><br />';		}				if(mysql_num_rows($resultMyStores) > 0) { // Do not show if there is no data			echo '<p>Available at:</p>';			while ($r = mysql_fetch_assoc($resultMyStores)) { 				echo '<p><img src="stores/'.$r['store_file'].'" alt="'.$r['store_name'].'" /></p>';			} 		}		 ?>             </div>    <!-- END POO -->        <!-- START PRODUCT OPTIONS -->   <div id="product-options">        <p><?php while ($rowColor = mysql_fetch_assoc($resultColor)) {         $color = $rowColor['color_file'];        if( $rowColor['color_id'] == $row['color']) {            echo "<img src=\"colors/$color\" />";            }        } ?><br /><b><?php echo htmlentities($row['finish']); ?></b><p>        <?php if (!empty($row['surface'])) { // Do not show if there is no data ?>        <p id="product-options-stand"><?php echo htmlentities($row['surface']); ?>in.<p>        <?php } else { }?>                <?php if (!empty($row['bracket'])) { // Do not show if there is no data ?>        <p id="product-options-bracket"><?php echo htmlentities($row['bracket']); ?>in.<p>        <?php } else { }?>                <p><small><b>Maximum Load Weights:</b></small></p>        <?php if (!empty($row['load_B'])) { // Do not show if there is no data ?>        <p><small>Bracket: <?php echo htmlentities($row['load_B']); ?> lbs.</small><br />        <?php } else { }?>        <?php if (!empty($row['load_TS'])) { // Do not show if there is no data ?>        <small>Top Surface: <?php echo htmlentities($row['load_TS']); ?> lbs.</small><br />        <?php } else { }?>        <?php if (!empty($row['load_S'])) { // Do not show if there is no data ?>        <small>Shelves:  <?php echo htmlentities($row['load_S']); ?> lbs.</small></p>        <?php } else { }?>            </div>   <!-- END PRODUCT OPTIONS -->       <!-- START PRODUCT DESCRIPTION -->   <div id="product-description">        <h2><?php echo htmlentities($row['title']); ?></h2>        <ul>        <li><b><?php echo htmlentities($row['depth']); ?>in.(D) x <?php echo htmlentities($row['width']); ?>in.(W) x <?php echo htmlentities($row['height']); ?>in.(H)</b></li>  		<!-- START TEXT DESCRIPTION -->        <?php        for($i=1; $i<=8;$i++) {			if (!empty($row['description_0'.$i])) { // Do not show if there is no data				echo  '<li>'.htmlentities($row['description_0'.$i]).'</li>';			}		}        ?>        <!-- START LINK DESCRIPTION -->          <?php 		while ($r = mysql_fetch_assoc($resultLinks)) { 			echo '<li><a href="links/img.php?src='.$r['link_file'].'" class="popup">'.$r['link_name'].'</a></li>';		} 		?>             </ul>    </div>    <!-- END PRODUCT DESCRIPTION -->                                 <!-- START PRODUCT IMAGES -->    <div id="product-images">        <p class="product-images-main"><img src="uploads/<?php echo htmlentities($row['filename_one']); ?>" id="slides" /></p>        <ul id="product-thumbnails">	          <?php if (!empty($row['filename_one'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_one']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_one']); ?>" /></a></li>        <?php } else { }?>                            <?php if (!empty($row['filename_two'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_two']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_two']); ?>" /></a></li>	            <?php } else { }?>                        <?php if (!empty($row['filename_three'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_three']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_three']); ?>" /></a></li>            <?php } else { }?>                        <?php if (!empty($row['filename_four'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_four']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_four']); ?>" /></a></li>	            <?php } else { }?>                        <?php if (!empty($row['filename_five'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_five']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_five']); ?>" /></a></li>            <?php } else { }?>                        <?php if (!empty($row['filename_six'])) { // Do not show if there is no data ?>            <li class="product-images-small"><a href="#" onclick="document.getElementById('slides').src='uploads/<?php echo htmlentities($row['filename_six']); ?>';"><img src="uploads/<?php echo htmlentities($row['filename_six']); ?>" /></a></li>          <?php } else { }?>        </ul>        <br class="clear" />        <ul id="product-directions">            <?php            if($prevID)                echo '<li><a href="products-catalog.php?product_id='.$prevID.'"><img src="images/button-previous.gif" alt="Previous" /></a></li>';            if($nextID)                echo '<li><a href="products-catalog.php?product_id='.$nextID.'"><img src="images/button-next.gif" alt="Next" /></a></li>';            ?>        </ul>    </div>	<!-- END PRODUCT IMAGES -->            	<?php } ?><?php include('includes/footer-main.php'); ?>